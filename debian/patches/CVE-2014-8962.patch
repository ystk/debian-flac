#! /bin/sh /usr/share/dpatch/dpatch-run
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: From 5b3033a2b355068c11fe637e14ac742d273f076e Mon Sep 17 00:00:00 2001
## DP: From: Erik de Castro Lopo <erikd@mega-nerd.com>
## DP: Date: Tue, 18 Nov 2014 07:20:25 -0800
## DP: Subject: [PATCH] src/libFLAC/stream_decoder.c : Fix buffer read overflow.
## DP: 
## DP: This is CVE-2014-8962.
## DP: 
## DP: Reported-by: Michele Spagnuolo,
## DP:              Google Security Team <mikispag@google.com>
## DP: ---
## DP:  src/libFLAC/stream_decoder.c |    6 +++++-
## DP:  1 files changed, 5 insertions(+), 1 deletions(-)
##
@DPATCH@
diff -urNad a/src/libFLAC/stream_decoder.c b/src/libFLAC/stream_decoder.c
--- a/src/libFLAC/stream_decoder.c
+++ b/src/libFLAC/stream_decoder.c
@@ -94,7 +94,7 @@
  *
  ***********************************************************************/
 
-static FLAC__byte ID3V2_TAG_[3] = { 'I', 'D', '3' };
+static const FLAC__byte ID3V2_TAG_[3] = { 'I', 'D', '3' };
 
 /***********************************************************************
  *
@@ -1386,6 +1386,10 @@
 			id = 0;
 			continue;
 		}
+
+		if(id >= 3)
+			return false;
+
 		if(x == ID3V2_TAG_[id]) {
 			id++;
 			i = 0;
